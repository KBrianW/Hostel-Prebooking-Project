<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Hostel Pre-Booking System{% endblock %}</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@500;600&display=swap" rel="stylesheet">

    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>

<body class="bg-dark text-light" style="font-family: 'Inter', sans-serif;">

    <!-- Navbar -->
    <nav class="navbar navbar-dark bg-black border-bottom border-secondary px-3">
        <span class="navbar-brand mb-0 h1" style="font-family: 'Poppins', sans-serif;">
            ANU Hostel System
        </span>
        <div>
            <!-- Notification Bell -->
{% if user.is_authenticated %}
<div class="d-inline me-3 position-relative" id="bell-container">
    <a class="nav-link text-light position-relative" href="{% if user.is_staff %}{% url 'admin_notifications_page' %}{% else %}{% url 'notifications_page' %}{% endif %}" id="notificationsLink" role="button" aria-label="Notifications">
        <i class="bi bi-bell fs-5"></i>
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="notifBadge" style="display:{% if unread_notifications_count > 0 %}inline{% else %}none{% endif %};">
            {{ unread_notifications_count|default:0 }}
        </span>
        <span id="notifDot" class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle" style="transform: translate(-20%, -40%); display:{% if unread_notifications_count > 0 %}inline-block{% else %}none{% endif %}; box-shadow:0 0 0 0 rgba(220,53,69,.7);"></span>
    </a>
</div>
{% endif %}

<!-- Logout Button -->
<a href="{% url 'logout' %}" class="btn btn-sm btn-outline-light">Logout</a>


        </div>
    </nav>

    <!-- Sidebar + Content Layout -->
    <div class="d-flex">
        <!-- Sidebar -->
        <div class="bg-black p-3 vh-100" style="width: 220px;">
            <ul class="nav flex-column" style="font-family: 'Poppins', sans-serif;">
                {% if user.is_staff %}
                    <li class="nav-item mb-2"><a href="{% url 'admin_dashboard' %}" class="nav-link text-light {% if request.resolver_match.url_name == 'admin_dashboard' %}fw-bold text-info{% endif %}">Dashboard</a></li>
                    <li class="nav-item mb-2"><a href="{% url 'manage_bookings' %}" class="nav-link text-light {% if request.resolver_match.url_name == 'manage_bookings' %}fw-bold text-info{% endif %}">Bookings</a></li>
                    <li class="nav-item mb-2"><a href="{% url 'admin_notifications_page' %}" class="nav-link text-light {% if request.resolver_match.url_name == 'admin_notifications_page' %}fw-bold text-info{% endif %}">Notifications</a></li>
                {% else %}
                    <li class="nav-item mb-2"><a href="{% url 'student_dashboard' %}" class="nav-link text-light {% if request.resolver_match.url_name == 'student_dashboard' %}fw-bold text-info{% endif %}">Dashboard</a></li>
                    <li class="nav-item mb-2"><a href="{% url 'available_rooms' %}" class="nav-link text-light {% if request.resolver_match.url_name == 'available_rooms' %}fw-bold text-info{% endif %}">Rooms</a></li>
                {% endif %}
                <li class="nav-item mb-2"><a href="{% url 'student_profile' %}" class="nav-link text-light {% if request.resolver_match.url_name == 'student_profile' %}fw-bold text-info{% endif %}">Profile</a></li>
            </ul>
        </div>

        <!-- Main content -->
        <div class="flex-grow-1 p-4" id="main-content">
            {% block content %}
            <!-- Page-specific content goes here -->
            {% endblock %}
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-2 mt-auto bg-black border-top border-secondary">
        <small class="text-muted">Â© 2025 ANU Hostel Management System</small>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Collapse sidebar on small screens
        (function(){
            const sidebar = document.querySelector('.bg-black.p-3.vh-100');
            if (window.innerWidth < 992) {
                sidebar.style.position = 'fixed';
                sidebar.style.zIndex = '1040';
                document.getElementById('main-content').style.marginLeft = '220px';
            }
        })();
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const badge = document.getElementById('notifBadge');
            const dot = document.getElementById('notifDot');

            function updateIndicators(count){
                if (!badge || !dot) return;
                if (count > 0) {
                    badge.textContent = count;
                    badge.style.display = 'inline';
                    dot.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                    dot.style.display = 'none';
                }
            }

            function fetchNotifications() {
                fetch("{% url 'fetch_notifications' %}")
                    .then(response => response.json())
                    .then(data => updateIndicators(data.unread_count))
                    .catch(() => {});
            }

            // Initial and interval updates
            fetchNotifications();
            setInterval(fetchNotifications, 20000);
        });
        </script>
        
</body>
</html>
